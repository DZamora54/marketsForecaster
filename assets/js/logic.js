const marketsData = [
  {
    name: "Albania",
    docMarket: "No",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Argentina",
    docMarket: "No",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Australia",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Austria",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bahrain",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Belgium",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bermuda",
    docMarket: "No",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bosnia",
    docMarket: "No",
    timeframeToOpen: 4,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Botswana",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bulgaria",
    docMarket: "No",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Canada",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Clearstream",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Costa Rica",
    docMarket: "No",
    timeframeToOpen: 4,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Croatia",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Cyprus",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Czech Republic",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Denmark",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Estonia",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Eswatini",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Euroclear",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Finland",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "France",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Georgia, Republic of",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Germany",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ghana",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Hong Kong (HKD)",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Hungary",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ireland",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Israel",
    docMarket: "No",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Italy",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ivory Coast",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Japan",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Jordan",
    docMarket: "No",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Kazakhstan",
    docMarket: "No",
    timeframeToOpen: 35,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Kenya",
    docMarket: "No",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Kuwait",
    docMarket: "No",
    timeframeToOpen: 20,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Latvia",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Lithuania",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Luxembourg",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Malawi",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Mauritius",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Mexico",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Morocco",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Namibia",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Netherlands",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "New Zealand",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Nigeria",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Norway",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Oman",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Panama",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Philippines",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Poland",
    docMarket: "No",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Portugal",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Romania",
    docMarket: "No",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Singapore",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "South Africa",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Spain",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Sweden",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Switzerland",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Tanzania",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Tunisia",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Uganda",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ukraine",
    docMarket: "No",
    timeframeToOpen: 14,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Kingdom",
    docMarket: "No",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United States",
    docMarket: "No",
    timeframeToOpen: 1,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Uruguay",
    docMarket: "No",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bangladesh",
    docMarket: "Yes",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Brazil",
    docMarket: "Yes",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Chile",
    docMarket: "Yes",
    timeframeToOpen: 3,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China Connect",
    docMarket: "Yes",
    timeframeToOpen: 20,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China Interbank Bond Connect (CIBM)",
    docMarket: "Yes",
    timeframeToOpen: 35,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China A-share",
    docMarket: "180",
    timeframeToOpen: 180,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China B-share Shanghai",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China B-share Shenzhen",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Colombia",
    docMarket: "Yes",
    timeframeToOpen: 12,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Egypt",
    docMarket: "Yes",
    timeframeToOpen: 6,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Greece",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Hong Kong (CNY)",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Iceland",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "India - FPI",
    docMarket: "Yes",
    timeframeToOpen: 40,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Indonesia",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Japan JGB",
    docMarket: "Yes",
    timeframeToOpen: 5,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Korea",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Malaysia",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Pakistan",
    docMarket: "Yes",
    timeframeToOpen: 21,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Peru",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Qatar",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Russia",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Saudi Arabia",
    docMarket: "Yes",
    timeframeToOpen: 8,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Serbia",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Slovak Republic",
    docMarket: "Yes",
    timeframeToOpen: 4,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Slovenia",
    docMarket: "Yes",
    timeframeToOpen: 4,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Sri Lanka",
    docMarket: "Yes",
    timeframeToOpen: 45,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Srpska",
    docMarket: "Yes",
    timeframeToOpen: 4,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Taiwan",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Thailand",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Turkey",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Arab Emirates / Abu Dhabi Exchange (ADX)",
    docMarket: "Yes",
    timeframeToOpen: 12,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Arab Emirates / Dubai Financial Market (DFM)",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Arab Emirates / Dubai Int'l Financial Center (DIFC)",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Vietnam",
    docMarket: "Yes",
    timeframeToOpen: 45,
    requestedDay1: "No",
    requestedAsap: "No",
    openDate: "MMM DD YYYY",
  },
];

let launchDate;
let amlKycSubmitDate;
let amlKycCompleteDateTimeframe = 15;
let mchDateTimeframe = 10;
let docsFromSSBTimeframe = 7;
let docsToSSBTimeframe = 7;
let docsToLocalTimeframe = 2;

let fundName;
let wmcId;
let ssbId;

let amlKycCompleteDate;
let mchDoneDate;
let docsDueFromSSBDate;
let docsToSSBDate;
let docsToLocalDate;

/* START MODAL OPENING AND CLOSING */
const openModalButtons = document.querySelectorAll("[data-modal-target]");
const closeModalButtons = document.querySelectorAll("[data-close-button]");
const overlay = document.getElementById("overlay");

openModalButtons.forEach((button) => {
  button.addEventListener("click", () => {
    const modal = document.querySelector(button.dataset.modalTarget);
    openModal(modal);
  });
});

overlay.addEventListener("click", () => {
  const modals = document.querySelectorAll(".modal.active");
  modals.forEach((modal) => {
    closeModal(modal);
  });
});

closeModalButtons.forEach((button) => {
  button.addEventListener("click", () => {
    const modal = button.closest(".modal");
    closeModal(modal);
  });
});

function openModal(modal) {
  if (modal == null) return;
  modal.classList.add("active");
  overlay.classList.add("active");
}

function closeModal(modal) {
  if (modal == null) return;
  modal.classList.remove("active");
  overlay.classList.remove("active");
}
/* END MODAL OPENING AND CLOSING */

/* START ADD DAY 1 MARKETS CHECKBOXES TO MODAL */
// On load calls populateDayOneMarketsToChooseFrom function
window.addEventListener("load", function () {
  this.populateDayOneMarketsToChooseFrom();
});

// Populate market list from marketsData
function populateDayOneMarketsToChooseFrom() {
  for (let i = 0; i < marketsData.length; i++) {
    let markets = document.getElementById("marketsList");
    let checkboxDiv = document.createElement("div");
    let checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.name = "name";
    checkbox.value = marketsData[i].name;
    checkbox.id = "dayOneCheckboxId";

    let label = document.createElement("label");
    label.htmlFor = "dayOneCheckboxId";
    label.appendChild(document.createTextNode(marketsData[i].name));

    markets.appendChild(checkboxDiv);
    checkboxDiv.appendChild(checkbox);
    checkboxDiv.appendChild(label);
  }
}
/* END ADD DAY 1 MARKETS CHECKBOXES TO MODAL */

/* START ADD REQUIRED ASAP MARKETS CHECKBOXES TO MODAL */
// On load calls populateRequiredAsapMarketsToChooseFrom function
window.addEventListener("load", function () {
  this.populateRequiredAsapMarketsToChooseFrom();
});

// Populate market list from marketsData
function populateRequiredAsapMarketsToChooseFrom() {
  for (let i = 0; i < marketsData.length; i++) {
    let asapMarkets = document.getElementById("marketsList2");
    let asapCheckboxDiv = document.createElement("div");
    let asapCheckbox = document.createElement("input");
    asapCheckbox.type = "checkbox";
    asapCheckbox.name = "asapName";
    asapCheckbox.value = marketsData[i].name;
    asapCheckbox.id = "asapCheckboxId";
    let asapLabel = document.createElement("label");
    asapLabel.htmlFor = "asapCheckboxId";
    asapLabel.appendChild(document.createTextNode(marketsData[i].name));
    asapMarkets.appendChild(asapCheckboxDiv);
    asapCheckboxDiv.appendChild(asapCheckbox);
    asapCheckboxDiv.appendChild(asapLabel);
  }
}
/* END ADD REQUIRED ASAP MARKETS CHECKBOXES TO MODAL */

/* START UPDATE DAY ONE MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */
// updates the marketsData requestedDay1 key to be "Yes" or "No" depending if the checkbox is checked or not checked
function getCheckedDayOneMarkets() {
  console.log("hello day 1");
  let checkboxes = document.getElementsByName("name");
  for (var checkbox of checkboxes) {
    for (let i = 0; i < marketsData.length; i++) {
      if (marketsData[i]["requestedAsap"] == "Yes - ASAP") {
        document.getElementById("dayOneCheckboxId").disabled = true;
      }
    }
    if (checkbox.checked) {
      let temp = checkbox.value;
      console.log("temp is " + checkbox.value);
      for (let i = 0; i < marketsData.length; i++) {
        if (marketsData[i]["name"] === checkbox.value && checkbox.checked) {
          console.log(checkbox.value + " has been selected.");
          marketsData[i]["requestedDay1"] = "Yes";
        }
      }
    }
    if (checkbox.checked == false) {
      for (let i = 0; i < marketsData.length; i++) {
        if (
          marketsData[i]["name"] === checkbox.value &&
          checkbox.checked == false
        ) {
          marketsData[i]["requestedDay1"] = "No";
        }
      }
    }
  }
}
/* END UPDATE DAY ONE MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */

/* START UPDATE ASAP MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */
// updates the marketsData requested key to be "Yes" or "No" depending if the checkbox is checked or not checked
function getCheckedAsapMarkets() {
  console.log("hello asap");
  let checkboxes = document.getElementsByName("asapName");
  for (var checkbox of checkboxes) {
    for (let i = 0; i < marketsData.length; i++) {
      if (marketsData[i]["requestedDay1"] == "Yes") {
        document.getElementById("asapCheckboxId").disabled = true;
      }
    }
    if (checkbox.checked) {
      let temp = checkbox.value;
      console.log("temp is " + checkbox.value);
      for (let i = 0; i < marketsData.length; i++) {
        if (marketsData[i]["name"] === checkbox.value && checkbox.checked) {
          console.log(checkbox.value + " has been selected.");
          marketsData[i]["requestedAsap"] = "Yes";
        }
      }
    }
    if (checkbox.checked == false) {
      for (let i = 0; i < marketsData.length; i++) {
        if (
          marketsData[i]["name"] === checkbox.value &&
          checkbox.checked == false
        ) {
          marketsData[i]["requestedAsap"] = "No";
        }
      }
    }
  }
}
/* END UPDATE ASAP MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */

/* START CHECK FOR DAY 1 NON DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */
function checkDayOneNonDoc(requested) {
  console.log("checking day one non doc");
  return requested["requestedDay1"] == "No";
}
function checkforDayOneNonDoc() {
  let result = marketsData.filter((market) => market["docMarket"] == "No");
  // console.log(result);
  if (result.every(checkDayOneNonDoc)) {
    console.log("no day one non doc markets requested");
  } else {
    console.log("someone picked a day one non doc market");
    updateNonDocDayOneMarketTables();
  }
}
/* END CHECK FOR DAY 1 NON DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */

/* START CHECK FOR DAY 1 DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */
function checkDayOneDoc(requested) {
  console.log("checking day one doc markets");
  return requested["requestedDay1"] == "No";
}
function checkforDayOneDoc() {
  let result = marketsData.filter((market) => market["docMarket"] == "Yes");
  // console.log("result is: " + result);
  if (result.every(checkDayOneDoc)) {
    console.log("no day one doc markets requested");
  } else {
    console.log("someone picked a day one doc market");
    updateDocDayOneMarketTables();
  }
}
/* END CHECK FOR DAY 1 DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */

/* START CHECK FOR ASAP NON DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */
function checkAsapNonDoc(requested) {
  console.log("checking asap non doc");
  return requested["requestedAsap"] == "No";
}
function checkforAsapNonDoc() {
  let result = marketsData.filter((market) => market["docMarket"] == "No");
  // console.log("result is: " + result);
  if (result.every(checkAsapNonDoc)) {
    console.log("no asap non doc markets requested");
  } else {
    console.log("someone picked an asap non doc market");
    updateNonDocAsapMarketTables();
  }
}
/* END CHECK FOR ASAP NON DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */

/* START CHECK FOR ASAP DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */
function checkAsapDoc(requested) {
  console.log("checking asap doc markets");
  return requested["requestedAsap"] == "No";
}
function checkforAsapDoc() {
  let result = marketsData.filter((market) => market["docMarket"] == "Yes");
  // console.log("result is: " + result);
  if (result.every(checkAsapDoc)) {
    console.log("no asap doc markets requested");
  } else {
    console.log("someone picked an asap doc market");
    updateDocAsapMarketTables();
  }
}
/* END CHECK FOR ASAP NON DOC SELECTED. IF NONE SELECTED,DO NOT CREATE DAY 1 NON DOC TABLE OR REMOVE EXISTING DAY 1 NON DOC TABLE. IF ANY DAY 1 NON DOC IS YES, THEN CREATE OR UPDATE DAY ONE NON DOC TABLE */

/*  START REMOVE NON DOC DAY 1 MARKETS TABLES */
function removeNonDocDayOneMarketsTables() {
  console.log("removing non doc day one markets tables");
  let elementExists = document.getElementById("table1header");
  console.log(elementExists);
  if (elementExists) {
    console.log("table1header exists");
    let elem = document.getElementById("table1header");
    elem.parentNode.removeChild(elem);
    let elem1 = document.getElementById("t1bodyid");
    elem1.parentNode.removeChild(elem1);
  } else {
    console.log("table1header does not exist");
  }
}
/*  END REMOVE NON DOC DAY 1 MARKETS TABLES */

/*  START REMOVE DOC DAY 1 MARKETS TABLES */
function removeDocDayOneMarketsTables() {
  console.log("removing doc day one markets tables");
  let elementExists = document.getElementById("table2header");
  console.log(elementExists);
  if (elementExists) {
    console.log("table2header exists");
    let elem = document.getElementById("table2header");
    elem.parentNode.removeChild(elem);
    let elem1 = document.getElementById("t2bodyid");
    elem1.parentNode.removeChild(elem1);
  } else {
    console.log("table2header does not exist");
  }
}
/*  END REMOVE DOC DAY 1 MARKETS TABLES */

/*  START REMOVE NON DOC ASAP MARKETS TABLES */
function removeNonDocAsapMarketsTables() {
  console.log("removing non doc asap markets tables");
  let elementExists = document.getElementById("table3header");
  console.log(elementExists);
  if (elementExists) {
    console.log("table3header exists");
    let elem = document.getElementById("table3header");
    elem.parentNode.removeChild(elem);
    let elem1 = document.getElementById("t3bodyid");
    elem1.parentNode.removeChild(elem1);
  } else {
    console.log("table3header does not exist");
  }
}
/*  END REMOVE NON DOC ASAP MARKETS TABLES */

/*  START REMOVE DOC ASAP MARKETS TABLES */
function removeDocAsapMarketsTables() {
  console.log("removing doc asap markets tables");
  let elementExists = document.getElementById("table4header");
  console.log(elementExists);
  if (elementExists) {
    console.log("table4header exists");
    let elem = document.getElementById("table4header");
    elem.parentNode.removeChild(elem);
    let elem1 = document.getElementById("t4bodyid");
    elem1.parentNode.removeChild(elem1);
  } else {
    console.log("table4header does not exist");
  }
}
/*  END REMOVE DOC ASAP MARKETS TABLES */

/* START CREATE NON DOC DAY 1 MARKETS TABLE */
function updateNonDocDayOneMarketTables() {
  console.log("updating non doc day 1 market tables");
  let table = document.querySelector("#table1");
  let data = ["name", "timeframeToOpen", "openDate"];
  console.log(data);
  generateTable(table, marketsData); // generate the table first
  generateTableHead(table, data); // then the head
  let tbody = table.querySelector("tbody");
  tbody.classList.add("tbodyClass");
  tbody.setAttribute("id", "t1bodyid");
}

// Creates the table header
function generateTableHead(table, data) {
  //console.log("generateTableHead is called");
  let thead = table.createTHead();
  let row = thead.insertRow();
  thead.setAttribute("id", "table1header");
  for (let key of data) {
    let th = document.createElement("th");
    let text = document.createTextNode(key);
    th.appendChild(text);
    row.appendChild(th);
  }
  //console.log("generateTableHead success");
}

// Creates the table body
function generateTable(table, data) {
  //console.log("generateTable is called");
  for (let element of data) {
    if (element["requestedDay1"] == "Yes" && element["docMarket"] == "No") {
      //  console.log("element: " + element["name"]);
      let row = table.insertRow();
      let cell = row.insertCell();
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      let text = document.createTextNode(element["name"]);
      let text2 = document.createTextNode(element["timeframeToOpen"]);
      let text3 = document.createTextNode(element["openDate"]);
      cell.appendChild(text);
      cell2.appendChild(text2);
      cell3.appendChild(text3);
    }
  }
  //console.log("generateTable success");
}
/* END CREATE NON DOC DAY 1 MARKETS TABLE */

/* START CREATE DOC DAY 1 MARKETS TABLE */
function updateDocDayOneMarketTables() {
  console.log("updating doc day 1 market tables");
  let table = document.querySelector("#table2");
  let data = ["name", "timeframeToOpen", "openDate"];
  console.log(data);
  generateTable2(table, marketsData); // generate the table first
  generateTable2Head(table, data); // then the head
  let tbody = table.querySelector("tbody");
  tbody.classList.add("tbodyClass");
  tbody.setAttribute("id", "t2bodyid");
}

// Creates the table header
function generateTable2Head(table, data) {
  console.log("generateTable2Head is running");
  let thead = table.createTHead();
  let row = thead.insertRow();
  thead.setAttribute("id", "table2header");
  for (let key of data) {
    let th = document.createElement("th");
    let text = document.createTextNode(key);
    th.appendChild(text);
    row.appendChild(th);
  }
  console.log("generateTable2Head success");
}

// Creates the table body
function generateTable2(table, data) {
  console.log("generateTable2 is running");
  for (let element of data) {
    if (element["requestedDay1"] == "Yes" && element["docMarket"] == "Yes") {
      console.log("element: " + element["name"]);
      let row = table.insertRow();
      let cell = row.insertCell();
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      let text = document.createTextNode(element["name"]);
      let text2 = document.createTextNode(element["timeframeToOpen"]);
      let text3 = document.createTextNode(element["openDate"]);
      cell.appendChild(text);
      cell2.appendChild(text2);
      cell3.appendChild(text3);
    }
  }
  console.log("generateTable2 success");
}
/* END CREATE DOC DAY 1 MARKETS TABLE */

/* START CREATE NON DOC ASAP MARKETS TABLE */
function updateNonDocAsapMarketTables() {
  console.log("updating non doc asap market tables");
  let table = document.querySelector("#table3");
  let data = ["name", "timeframeToOpen", "openDate"];
  console.log(data);
  generateTable3(table, marketsData); // generate the table first
  generateTable3Head(table, data); // then the head
  let tbody = table.querySelector("tbody");
  tbody.classList.add("tbodyClass");
  tbody.setAttribute("id", "t3bodyid");
}

// Creates the table header
function generateTable3Head(table, data) {
  console.log("generateTable3Head is called");
  let thead = table.createTHead();
  let row = thead.insertRow();
  thead.setAttribute("id", "table3header");
  for (let key of data) {
    let th = document.createElement("th");
    let text = document.createTextNode(key);
    th.appendChild(text);
    row.appendChild(th);
  }
  console.log("generateTable3Head success");
}

// Creates the table body
function generateTable3(table, data) {
  console.log("generateTable3 is running");
  for (let element of data) {
    if (element["requestedAsap"] == "Yes" && element["docMarket"] == "No") {
      console.log("element: " + element["name"]);
      let row = table.insertRow();
      let cell = row.insertCell();
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      let text = document.createTextNode(element["name"]);
      let text2 = document.createTextNode(element["timeframeToOpen"]);
      let text3 = document.createTextNode(element["openDate"]);
      cell.appendChild(text);
      cell2.appendChild(text2);
      cell3.appendChild(text3);
    }
  }
  console.log("generateTable3 success");
}
/* END CREATE NON DOC ASAP MARKETS TABLE */

/* START CREATE DOC ASAP MARKETS TABLE */
function updateDocAsapMarketTables() {
  console.log("updating doc asap markets");
  let table = document.querySelector("#table4");
  let data = ["name", "timeframeToOpen", "openDate"];
  console.log(data);
  generateTable4(table, marketsData); // generate the table first
  generateTable4Head(table, data); // then the head
  let tbody = table.querySelector("tbody");
  tbody.classList.add("tbodyClass");
  tbody.setAttribute("id", "t4bodyid");
}

// Creates the table header
function generateTable4Head(table, data) {
  console.log("generateTable4Head is running");
  let thead = table.createTHead();
  let row = thead.insertRow();
  thead.setAttribute("id", "table4header");
  for (let key of data) {
    let th = document.createElement("th");
    let text = document.createTextNode(key);
    th.appendChild(text);
    row.appendChild(th);
  }
  console.log("generateTable4Head success");
}

// Creates the table body
function generateTable4(table, data) {
  console.log("generateTable4 is running");
  for (let element of data) {
    if (element["requestedAsap"] == "Yes" && element["docMarket"] == "Yes") {
      console.log("element: " + element["name"]);
      let row = table.insertRow();
      let cell = row.insertCell();
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      let text = document.createTextNode(element["name"]);
      let text2 = document.createTextNode(element["timeframeToOpen"]);
      let text3 = document.createTextNode(element["openDate"]);
      cell.appendChild(text);
      cell2.appendChild(text2);
      cell3.appendChild(text3);
    }
  }
  console.log("generateTable4 success");
}
/* END CREATE DOC ASAP MARKETS TABLE */

/* SUBMIT FUND DETAILS */
function submitFundDetails() {
  console.log("submitting fund details");
  fundName = document.getElementById("fname").value;
  wmcId = document.getElementById("wmcid").value;
  ssbId = document.getElementById("ssbid").value;
  launchDate = document.getElementById("launchdate").value;
  amlKycSubmitDate = document.getElementById("amldate").value;
  updateOpenDate();
  updateSlaDates();
}
/* END FUND DETAILS */

/* START UPDATE OPEN DATE FOR EACH MARKET */
function updateOpenDate() {
  console.log("updating open dates");
  for (let i = 0; i < marketsData.length; i++) {
    console.log(marketsData[i]["timeframeToOpen"]);
    let totalTimeToOpen =
      amlKycCompleteDateTimeframe +
      mchDateTimeframe +
      docsFromSSBTimeframe +
      docsToSSBTimeframe +
      docsToLocalTimeframe +
      marketsData[i]["timeframeToOpen"];
    console.log(totalTimeToOpen);
    marketsData[i]["openDate"] = convertInDateToCompletionDate(
      totalTimeToOpen,
      amlKycSubmitDate
    );
    console.log(marketsData[i]["openDate"]);
  }
}
/* END UPDATE OPEN DATE FOR EACH MARKET */

/* START UPDATE SLA DATES */
function updateSlaDates() {
  console.log("updating SLA dates");
  amlKycCompleteDate = convertInDateToCompletionDate(
    amlKycCompleteDateTimeframe,
    amlKycSubmitDate
  );
  mchDoneDate = convertInDateToCompletionDate(
    mchDateTimeframe,
    amlKycCompleteDate
  );
  docsDueFromSSBDate = convertInDateToCompletionDate(
    docsFromSSBTimeframe,
    mchDoneDate
  );
  docsToSSBDate = convertInDateToCompletionDate(
    docsToSSBTimeframe,
    docsDueFromSSBDate
  );
  docsToLocalDate = convertInDateToCompletionDate(
    docsToLocalTimeframe,
    docsToSSBDate
  );

  document.getElementById(
    "amlKycCompleteDateCell"
  ).innerHTML = amlKycCompleteDate;
  document.getElementById("mchDoneDateCell").innerHTML = mchDoneDate;
  document.getElementById(
    "docsDueFromSscDateCell"
  ).innerHTML = docsDueFromSSBDate;
  document.getElementById("docsDueToSscDateCell").innerHTML = docsToSSBDate;
  document.getElementById("sscToLocalDateCell").innerHTML = docsToLocalDate;
}
/* END UPDATE SLA DATES */

/* START FUNCTION TO ADD X NUMBER OF BUSINESS DAYS TO A GIVEN DATE */
// The idea was to start with the business days and count backwards to zero for each day encountered that fell in to the range of a business day.
//This use of switch would enable a person to declare a day in the week as a non-business day, for example someone may not work on a monday, therefore the addition of case:1 would include a monday.
// This is a simple script and does not take in to account public or bank holidays, that would be asking for a much more complex script to work with.
// The result is a date that is set to the date of shipping, the user can then extract the date info in any format that they please, eg.
function convertInDateToCompletionDate(numberOfBusinessDaysToAdd, beginDateIn) {
  let businessDays = numberOfBusinessDaysToAdd,
    counter = 1; // set to 1 to count from next business day
  let endDateOut;
  while (businessDays > 0) {
    let tmp = new Date(beginDateIn.replace(/-/g, "/"));
    let startDate = new Date(beginDateIn.replace(/-/g, "/"));
    tmp.setDate(startDate.getDate() + counter++);
    switch (tmp.getDay()) {
      case 0:
      case 6:
        break; // sunday & saturday
      default:
        businessDays--;
    }
    endDateOut = tmp.toUTCString().slice(5, 16);
  }
  console.log(endDateOut);
  console.log(typeof endDateOut);
  return endDateOut;
}
/* END FUNCTION TO ADD X NUMBER OF BUSINESS DAYS TO A GIVEN DATE */

/* START DOWNLOAD EXCEL AND CSV BUTTONS */
let btnExportCSV = document.querySelector("#exportCSVBtn");
let btnExportXLS = document.querySelector("#exportExcelBtn");
const table1 = document.querySelector("#table1");
const table2 = document.querySelector("#table2");
const table3 = document.querySelector("#table3");
const table4 = document.querySelector("#table4");
const tables = document.querySelectorAll("tbody");
// tables[0].appendChild(tables[1].querySelectorAll("tr"));
btnExportCSV.onclick = function () {
  console.log("Export in CSV");
  exportCSV();
};

btnExportXLS.onclick = () => {
  console.log("Export in Excel");
  exportXLS();
};

function exportCSV() {
  let csvContent = [];
  for (let i = 0; i < marketsData.length; i++) {
    if (
      marketsData[i]["requestedDay1"] == "Yes" ||
      marketsData[i]["requestedAsap"] == "Yes"
    ) {
      csvContent.push(
        marketsData[i]["name"] + "," + launchDate + "," + fundName
      );
    }
  }
  csvContent = encodeURI(csvContent.join("\n"));
  console.log(csvContent);

  const csvContentUrl = "data:text/csv;charset=utf-8," + csvContent;

  triggerDownload(csvContentUrl, "markets.csv");
}

function exportXLS() {
  const table1Content = table1.outerHTML.replace(/ /g, "%20");
  const table2Content = table2.outerHTML.replace(/ /g, "%20");
  const table3Content = table3.outerHTML.replace(/ /g, "%20");
  const table4Content = table4.outerHTML.replace(/ /g, "%20");
  // console.log(tableContent);
  const tableHTMLUrl =
    "data:application/vnd.ms-excel;charset=utf-8," +
    table1Content +
    table2Content +
    table3Content +
    table4Content;
  console.log(tableHTMLUrl);
  triggerDownload(tableHTMLUrl, "markets.xls");
}

function triggerDownload(url, filename) {
  const downloadLink = document.createElement("a");
  downloadLink.href = url;
  downloadLink.download = filename;
  document.body.appendChild(downloadLink);
  downloadLink.click();
}
/* END DOWNLOAD EXCEL AND CSV BUTTONS */

// CHANGE THE BACKGROUND OF AN LI ELEMENT ONCLICK
//market.classList.add("type");
// market.onclick = function() {
//   console.log(this.className)
//   if (this.className == "unselected") {
//     this.classList.remove("unselected")
//     this.classList.add("selected")
//   } else if (this.className == "selected") {
//     this.classList.remove("selected")
//     this.classList.add("unselected")
//   }
// }
//market.innerText = marketsData[i].name;
//markets.appendChild(market);
