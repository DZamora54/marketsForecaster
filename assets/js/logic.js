const marketsData = [
  {
    name: "Albania",
    docMarket: "No",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Argentina",
    docMarket: "No",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Australia",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Austria",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bahrain",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Belgium",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bermuda",
    docMarket: "No",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bosnia",
    docMarket: "No",
    timeframeToOpen: 4,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Botswana",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bulgaria",
    docMarket: "No",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Canada",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Clearstream",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Costa Rica",
    docMarket: "No",
    timeframeToOpen: 4,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Croatia",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Cyprus",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Czech Republic",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Denmark",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Estonia",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Eswatini",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Euroclear",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Finland",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "France",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Georgia, Republic of",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Germany",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ghana",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Hong Kong (HKD)",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Hungary",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ireland",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Israel",
    docMarket: "No",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Italy",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ivory Coast",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Japan",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Jordan",
    docMarket: "No",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Kazakhstan",
    docMarket: "No",
    timeframeToOpen: 35,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Kenya",
    docMarket: "No",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Kuwait",
    docMarket: "No",
    timeframeToOpen: 20,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Latvia",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Lithuania",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Luxembourg",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Malawi",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Mauritius",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Mexico",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Morocco",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Namibia",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Netherlands",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "New Zealand",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Nigeria",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Norway",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Oman",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Panama",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Philippines",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Poland",
    docMarket: "No",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Portugal",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Romania",
    docMarket: "No",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Singapore",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "South Africa",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Spain",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Sweden",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Switzerland",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Tanzania",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Tunisia",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Uganda",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Ukraine",
    docMarket: "No",
    timeframeToOpen: 14,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Kingdom",
    docMarket: "No",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United States",
    docMarket: "No",
    timeframeToOpen: 1,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Uruguay",
    docMarket: "No",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Bangladesh",
    docMarket: "Yes",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Brazil",
    docMarket: "Yes",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Chile",
    docMarket: "Yes",
    timeframeToOpen: 3,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China Connect",
    docMarket: "Yes",
    timeframeToOpen: 20,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China Interbank Bond Connect (CIBM)",
    docMarket: "Yes",
    timeframeToOpen: 35,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China A-share",
    docMarket: "180",
    timeframeToOpen: 180,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China B-share Shanghai",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "China B-share Shenzhen",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Colombia",
    docMarket: "Yes",
    timeframeToOpen: 12,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Egypt",
    docMarket: "Yes",
    timeframeToOpen: 6,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Greece",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Hong Kong (CNY)",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Iceland",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "India - FPI",
    docMarket: "Yes",
    timeframeToOpen: 40,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Indonesia",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Japan JGB",
    docMarket: "Yes",
    timeframeToOpen: 5,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Korea",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Malaysia",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Pakistan",
    docMarket: "Yes",
    timeframeToOpen: 21,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Peru",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Qatar",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Russia",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Saudi Arabia",
    docMarket: "Yes",
    timeframeToOpen: 8,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Serbia",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Slovak Republic",
    docMarket: "Yes",
    timeframeToOpen: 4,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Slovenia",
    docMarket: "Yes",
    timeframeToOpen: 4,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Sri Lanka",
    docMarket: "Yes",
    timeframeToOpen: 45,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Srpska",
    docMarket: "Yes",
    timeframeToOpen: 4,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Taiwan",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Thailand",
    docMarket: "Yes",
    timeframeToOpen: 2,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Turkey",
    docMarket: "Yes",
    timeframeToOpen: 10,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Arab Emirates / Abu Dhabi Exchange (ADX)",
    docMarket: "Yes",
    timeframeToOpen: 12,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Arab Emirates / Dubai Financial Market (DFM)",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "United Arab Emirates / Dubai Int'l Financial Center (DIFC)",
    docMarket: "Yes",
    timeframeToOpen: 7,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
  {
    name: "Vietnam",
    docMarket: "Yes",
    timeframeToOpen: 45,
    requested: "No",
    openDate: "MMM DD YYYY",
  },
];

let launchDate;
let amlKycSubmitDate;
let amlKycCompleteDateTimeframe = 15;
let mchDateTimeframe = 10;
let docsFromSSBTimeframe = 7;
let docsToSSBTimeframe = 7;
let docsToLocalTimeframe = 2;

let fundName;
let wmcId;
let ssbId;

let amlKycCompleteDate;
let mchDoneDate;
let docsDueFromSSBDate;
let docsToSSBDate;
let docsToLocalDate;

/* START MODAL OPENING AND CLOSING */
const openModalButtons = document.querySelectorAll("[data-modal-target]");
const closeModalButtons = document.querySelectorAll("[data-close-button]");
const overlay = document.getElementById("overlay");

openModalButtons.forEach((button) => {
  button.addEventListener("click", () => {
    const modal = document.querySelector(button.dataset.modalTarget);
    openModal(modal);
  });
});

overlay.addEventListener("click", () => {
  const modals = document.querySelectorAll(".modal.active");
  modals.forEach((modal) => {
    closeModal(modal);
  });
});

closeModalButtons.forEach((button) => {
  button.addEventListener("click", () => {
    const modal = button.closest(".modal");
    closeModal(modal);
  });
});

function openModal(modal) {
  if (modal == null) return;
  modal.classList.add("active");
  overlay.classList.add("active");
}

function closeModal(modal) {
  if (modal == null) return;
  modal.classList.remove("active");
  overlay.classList.remove("active");
}
/* END MODAL OPENING AND CLOSING */

/* START ADD MARKETS CHECKBOXES TO MODAL */
// On load calls populateMarketsToChooseFrom function
window.addEventListener("load", function () {
  this.populateNonDocMarketsToChooseFrom();
});

// Populate market list from marketData
function populateNonDocMarketsToChooseFrom() {
  for (let i = 0; i < marketsData.length; i++) {
    if (marketsData[i].docMarket == "No") {
      let markets = document.getElementById("marketsList");
      let checkboxDiv = document.createElement("div");
      let checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.name = "name";
      checkbox.value = marketsData[i].name;
      checkbox.id = "nonDocCheckboxId";

      let label = document.createElement("label");
      label.htmlFor = "nonDocCheckboxId";
      label.appendChild(document.createTextNode(marketsData[i].name));

      markets.appendChild(checkboxDiv);
      checkboxDiv.appendChild(checkbox);
      checkboxDiv.appendChild(label);
    }
  }
}
/* END ADD MARKETS CHECKBOXES TO MODAL */

/* START ADD NON DOC ASAP MARKETS CHECKBOXES TO MODAL */
// On load calls populateMarketsToChooseFrom function
window.addEventListener("load", function () {
  this.populateNonDocAsapMarketsToChooseFrom();
});

// Populate market list from marketData
function populateNonDocAsapMarketsToChooseFrom() {
  for (let i = 0; i < marketsData.length; i++) {
    if (marketsData[i].docMarket == "No") {
      console.log(1);
      let asapMarkets = document.getElementById("marketsList2");
      let asapCheckboxDiv = document.createElement("div");
      let asapCheckbox = document.createElement("input");
      asapCheckbox.type = "checkbox";
      asapCheckbox.name = "asapName";
      asapCheckbox.value = marketsData[i].name;
      asapCheckbox.id = "nonDocAsapCheckboxId";
      let asapLabel = document.createElement("label");
      asapLabel.htmlFor = "nonDocAsapCheckboxId";
      asapLabel.appendChild(document.createTextNode(marketsData[i].name));
      asapMarkets.appendChild(asapCheckboxDiv);
      asapCheckboxDiv.appendChild(asapCheckbox);
      asapCheckboxDiv.appendChild(asapLabel);
    }
  }
}
/* END ADD NON DOC ASAP MARKETS CHECKBOXES TO MODAL */

/* START UPDATE DAY ONE NON DOC MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */
// updates the marketsData requested key to be "Yes" or "No" depending if the checkbox is checked or not checked
function getCheckedDayOneNonDocMarkets() {
  console.log("hello");
  let checkboxes = document.getElementsByName("name");
  for (var checkbox of checkboxes) {
    for (let i = 0; i < marketsData.length; i++) {
      if (marketsData[i]["requeted"] == "Yes - ASAP") {
        document.getElementById("nonDocCheckboxId").disabled = true;
      }
    }
    if (checkbox.checked) {
      let temp = checkbox.value;
      console.log("temp is " + checkbox.value);
      for (let i = 0; i < marketsData.length; i++) {
        if (marketsData[i]["name"] === checkbox.value && checkbox.checked) {
          console.log(checkbox.value + " has been selected.");
          marketsData[i]["requested"] = "Yes - Day One";
        }
      }
    }
    if (checkbox.checked == false) {
      for (let i = 0; i < marketsData.length; i++) {
        if (
          marketsData[i]["name"] === checkbox.value &&
          checkbox.checked == false
        ) {
          marketsData[i]["requested"] = "No";
        }
      }
    }
  }
}
/* END UPDATE DAY ONE NON DOC MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */

function checkCheckboxes(marketRequested) {
  return marketRequested["requested"] == "No";
}
function checkforchecks() {
  if (marketsData.every(checkCheckboxes)) {
    console.log("no markets requested");
  } else {
    console.log("someone picked a market");
    updateMarketTables();
  }
}

function checkCheckboxes2(marketRequested) {
  return marketRequested["requested"] == "No";
}
function checkforchecks2() {
  if (marketsData.every(checkCheckboxes)) {
    console.log("no markets requested");
  } else {
    console.log("someone picked a market");
    updateNonDocAsapMarketTables();
  }
}

/* START UPDATE ASAP NON DOC MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */
// updates the marketsData requested key to be "Yes" or "No" depending if the checkbox is checked or not checked
function getCheckedAsapNonDocMarkets() {
  console.log("hello");
  let checkboxes = document.getElementsByName("asapName");
  for (var checkbox of checkboxes) {
    for (let i = 0; i < marketsData.length; i++) {
      if (marketsData[i]["requested"] == "Yes - Day One") {
        document.getElementById("nonDocAsapCheckboxId").disabled = true;
      }
    }
    if (checkbox.checked) {
      let temp = checkbox.value;
      console.log("temp is " + checkbox.value);
      for (let i = 0; i < marketsData.length; i++) {
        if (marketsData[i]["name"] === checkbox.value && checkbox.checked) {
          console.log(checkbox.value + " has been selected.");
          marketsData[i]["requested"] = "Yes - ASAP";
        }
      }
    }
    if (checkbox.checked == false) {
      for (let i = 0; i < marketsData.length; i++) {
        if (
          marketsData[i]["name"] === checkbox.value &&
          checkbox.checked == false
        ) {
          marketsData[i]["requested"] = "No";
        }
      }
    }
  }
}
/* END UPDATE ASAP NON DOC MARKETS REQUESTED KEY DEPENDING ON CHECKED BOOLEAN AND REQUESTED STATUS */

/*  START REMOVE NON DOC DAY 1 MARKETS TABLES */
function removeMarketsTables() {
  console.log("removing markets tables");
  let elementExists = document.getElementById("table1header");
  console.log(elementExists);
  if (elementExists) {
    console.log("table1header exists");
    let elem = document.getElementById("table1header");
    elem.parentNode.removeChild(elem);
    let elem1 = document.getElementById("tbodyid");
    elem1.parentNode.removeChild(elem1);
  } else {
    console.log("table1header does not exist");
  }
}
/*  END REMOVE NON DOC DAY 1 MARKETS TABLES */

/*  START REMOVE NON DOC ASAP MARKETS TABLES */
function removeNonDocAsapMarketsTables() {
  console.log("removing markets tables");
  let elementExists = document.getElementById("table2header");
  console.log(elementExists);
  if (elementExists) {
    console.log("table2header exists");
    let elem = document.getElementById("table2header");
    elem.parentNode.removeChild(elem);
    let elem1 = document.getElementById("tbodyid");
    elem1.parentNode.removeChild(elem1);
  } else {
    console.log("table2header does not exist");
  }
}
/*  END REMOVE NON DOC DAY ASAP MARKETS TABLES */

/* START CREATE NON DOC DAY 1 MARKETS TABLES */
// the table is getting created each time the button is clicked and appending to any existing table. i need to delete any existing table first and then create the table only once for each click
function updateMarketTables() {
  console.log("Hola");
  console.log("Red Red Wine");
  let table = document.querySelector("#table1");
  let data = ["name", "timeframeToOpen", "openDate"];
  console.log(data);
  generateTable(table, marketsData); // generate the table first
  generateTableHead(table, data); // then the head
  let tbody = table.querySelector("tbody");
  tbody.classList.add("tbodyClass");
  tbody.setAttribute("id", "tbodyid");
}

// Creates the table header
function generateTableHead(table, data) {
  let thead = table.createTHead();
  let row = thead.insertRow();
  thead.setAttribute("id", "table1header");
  for (let key of data) {
    let th = document.createElement("th");
    let text = document.createTextNode(key);
    th.appendChild(text);
    row.appendChild(th);
  }
}

// Creates the table body
function generateTable(table, data) {
  for (let element of data) {
    if (element["requested"] == "Yes - Day One") {
      console.log("element: " + element["name"]);
      let row = table.insertRow();
      let cell = row.insertCell();
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      let text = document.createTextNode(element["name"]);
      let text2 = document.createTextNode(element["timeframeToOpen"]);
      let text3 = document.createTextNode(element["openDate"]);
      cell.appendChild(text);
      cell2.appendChild(text2);
      cell3.appendChild(text3);
    }
  }
}
/* END CREATE NON DOC DAY 1 MARKETS TABLES */

/* START CREATE NON DOC ASAP MARKETS TABLES */
// the table is getting created each time the button is clicked and appending to any existing table. i need to delete any existing table first and then create the table only once for each click
function updateNonDocAsapMarketTables() {
  console.log("Hola");
  console.log("Red Red Wine");
  let table = document.querySelector("#table2");
  let data = ["name", "timeframeToOpen", "openDate"];
  console.log(data);
  generateTable2(table, marketsData); // generate the table first
  generateTable2Head(table, data); // then the head
  let tbody = table.querySelector("tbody");
  tbody.classList.add("tbodyClass");
  tbody.setAttribute("id", "tbodyid");
}

// // Creates the table header
function generateTable2Head(table, data) {
  let thead = table.createTHead();
  let row = thead.insertRow();
  thead.setAttribute("id", "table2header");
  for (let key of data) {
    let th = document.createElement("th");
    let text = document.createTextNode(key);
    th.appendChild(text);
    row.appendChild(th);
  }
}

// // Creates the table body
function generateTable2(table, data) {
  for (let element of data) {
    if (element["requested"] == "Yes - ASAP") {
      console.log("element: " + element["name"]);
      let row = table.insertRow();
      let cell = row.insertCell();
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      let text = document.createTextNode(element["name"]);
      let text2 = document.createTextNode(element["timeframeToOpen"]);
      let text3 = document.createTextNode(element["openDate"]);
      cell.appendChild(text);
      cell2.appendChild(text2);
      cell3.appendChild(text3);
    }
  }
}
/* END CREATE NON DOC ASAP MARKETS TABLES */

/* SUBMIT FUND DETAILS */
function submitFundDetails() {
  console.log("submitting fund details");
  fundName = document.getElementById("fname").value;
  wmcId = document.getElementById("wmcid").value;
  ssbId = document.getElementById("ssbid").value;
  launchDate = document.getElementById("launchdate").value;
  amlKycSubmitDate = document.getElementById("amldate").value;
  updateOpenDate();
  updateSlaDates();
}
/* END FUND DETAILS */

/* START UPDATE OPEN DATE FOR EACH MARKET */
function updateOpenDate() {
  console.log("updating open dates");
  for (let i = 0; i < marketsData.length; i++) {
    console.log(marketsData[i]["timeframeToOpen"]);
    let totalTimeToOpen =
      amlKycCompleteDateTimeframe +
      mchDateTimeframe +
      docsFromSSBTimeframe +
      docsToSSBTimeframe +
      docsToLocalTimeframe +
      marketsData[i]["timeframeToOpen"];
    console.log(totalTimeToOpen);
    marketsData[i]["openDate"] = convertInDateToCompletionDate(
      totalTimeToOpen,
      amlKycSubmitDate
    );
    console.log(marketsData[i]["openDate"]);
  }
}
/* END UPDATE OPEN DATE FOR EACH MARKET */

/* START UPDATE SLA DATES */
function updateSlaDates() {
  console.log("updating SLA dates");
  amlKycCompleteDate = convertInDateToCompletionDate(
    amlKycCompleteDateTimeframe,
    amlKycSubmitDate
  );
  mchDoneDate = convertInDateToCompletionDate(
    mchDateTimeframe,
    amlKycCompleteDate
  );
  docsDueFromSSBDate = convertInDateToCompletionDate(
    docsFromSSBTimeframe,
    mchDoneDate
  );
  docsToSSBDate = convertInDateToCompletionDate(
    docsToSSBTimeframe,
    docsDueFromSSBDate
  );
  docsToLocalDate = convertInDateToCompletionDate(
    docsToLocalTimeframe,
    docsToSSBDate
  );

  document.getElementById(
    "amlKycCompleteDateCell"
  ).innerHTML = amlKycCompleteDate;
  document.getElementById("mchDoneDateCell").innerHTML = mchDoneDate;
  document.getElementById(
    "docsDueFromSscDateCell"
  ).innerHTML = docsDueFromSSBDate;
  document.getElementById("docsDueToSscDateCell").innerHTML = docsToSSBDate;
  document.getElementById("sscToLocalDateCell").innerHTML = docsToLocalDate;
}
/* END UPDATE SLA DATES */

/* START FUNCTION TO ADD X NUMBER OF BUSINESS DAYS TO A GIVEN DATE */
// The idea was to start with the business days and count backwards to zero for each day encountered that fell in to the range of a business day.
//This use of switch would enable a person to declare a day in the week as a non-business day, for example someone may not work on a monday, therefore the addition of case:1 would include a monday.
// This is a simple script and does not take in to account public or bank holidays, that would be asking for a much more complex script to work with.
// The result is a date that is set to the date of shipping, the user can then extract the date info in any format that they please, eg.
function convertInDateToCompletionDate(numberOfBusinessDaysToAdd, beginDateIn) {
  let businessDays = numberOfBusinessDaysToAdd,
    counter = 1; // set to 1 to count from next business day
  let endDateOut;
  while (businessDays > 0) {
    let tmp = new Date(beginDateIn.replace(/-/g, "/"));
    let startDate = new Date(beginDateIn.replace(/-/g, "/"));
    tmp.setDate(startDate.getDate() + counter++);
    switch (tmp.getDay()) {
      case 0:
      case 6:
        break; // sunday & saturday
      default:
        businessDays--;
    }
    endDateOut = tmp.toUTCString().slice(5, 16);
  }
  console.log(endDateOut);
  console.log(typeof endDateOut);
  return endDateOut;
}
/* END FUNCTION TO ADD X NUMBER OF BUSINESS DAYS TO A GIVEN DATE */

// CHANGE THE BACKGROUND OF AN LI ELEMENT ONCLICK
//market.classList.add("type");
// market.onclick = function() {
//   console.log(this.className)
//   if (this.className == "unselected") {
//     this.classList.remove("unselected")
//     this.classList.add("selected")
//   } else if (this.className == "selected") {
//     this.classList.remove("selected")
//     this.classList.add("unselected")
//   }
// }
//market.innerText = marketsData[i].name;
//markets.appendChild(market);
